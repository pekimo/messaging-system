!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var t;t="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,t.messagingSystem=e()}}(function(){var e;return function t(e,n,r){function i(o,l){if(!n[o]){if(!e[o]){var c="function"==typeof require&&require;if(!l&&c)return c(o,!0);if(s)return s(o,!0);var a=new Error("Cannot find module '"+o+"'");throw a.code="MODULE_NOT_FOUND",a}var f=n[o]={exports:{}};e[o][0].call(f.exports,function(t){var n=e[o][1][t];return i(n?n:t)},f,f.exports,t,e,n,r)}return n[o].exports}for(var s="function"==typeof require&&require,o=0;o<r.length;o++)i(r[o]);return i}({1:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(n,"__esModule",{value:!0});var i=e("./models/server"),s=r(i),o=e("./models/client"),l=r(o);n["default"]={createServer:function(){return new s["default"]},createClient:function(e){return new l["default"](e)}}},{"./models/client":3,"./models/server":4}],2:[function(t,n,r){!function(t){function i(){this._events={},this._conf&&s.call(this,this._conf)}function s(e){e&&(this._conf=e,e.delimiter&&(this.delimiter=e.delimiter),e.maxListeners&&(this._events.maxListeners=e.maxListeners),e.wildcard&&(this.wildcard=e.wildcard),e.newListener&&(this.newListener=e.newListener),this.wildcard&&(this.listenerTree={}))}function o(e){this._events={},this.newListener=!1,s.call(this,e)}function l(e,t,n,r){if(!n)return[];var i,s,o,c,a,f,u,h=[],p=t.length,d=t[r],v=t[r+1];if(r===p&&n._listeners){if("function"==typeof n._listeners)return e&&e.push(n._listeners),[n];for(i=0,s=n._listeners.length;s>i;i++)e&&e.push(n._listeners[i]);return[n]}if("*"===d||"**"===d||n[d]){if("*"===d){for(o in n)"_listeners"!==o&&n.hasOwnProperty(o)&&(h=h.concat(l(e,t,n[o],r+1)));return h}if("**"===d){u=r+1===p||r+2===p&&"*"===v,u&&n._listeners&&(h=h.concat(l(e,t,n,p)));for(o in n)"_listeners"!==o&&n.hasOwnProperty(o)&&("*"===o||"**"===o?(n[o]._listeners&&!u&&(h=h.concat(l(e,t,n[o],p))),h=h.concat(l(e,t,n[o],r))):h=o===v?h.concat(l(e,t,n[o],r+2)):h.concat(l(e,t,n[o],r)));return h}h=h.concat(l(e,t,n[d],r+1))}if(c=n["*"],c&&l(e,t,c,r+1),a=n["**"])if(p>r){a._listeners&&l(e,t,a,p);for(o in a)"_listeners"!==o&&a.hasOwnProperty(o)&&(o===v?l(e,t,a[o],r+2):o===d?l(e,t,a[o],r+1):(f={},f[o]=a[o],l(e,t,{"**":f},r+1)))}else a._listeners?l(e,t,a,p):a["*"]&&a["*"]._listeners&&l(e,t,a["*"],p);return h}function c(e,t){e="string"==typeof e?e.split(this.delimiter):e.slice();for(var n=0,r=e.length;r>n+1;n++)if("**"===e[n]&&"**"===e[n+1])return;for(var i=this.listenerTree,s=e.shift();s;){if(i[s]||(i[s]={}),i=i[s],0===e.length){if(i._listeners){if("function"==typeof i._listeners)i._listeners=[i._listeners,t];else if(a(i._listeners)&&(i._listeners.push(t),!i._listeners.warned)){var o=f;"undefined"!=typeof this._events.maxListeners&&(o=this._events.maxListeners),o>0&&i._listeners.length>o&&(i._listeners.warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",i._listeners.length),console.trace&&console.trace())}}else i._listeners=t;return!0}s=e.shift()}return!0}var a=Array.isArray?Array.isArray:function(e){return"[object Array]"===Object.prototype.toString.call(e)},f=10;o.EventEmitter2=o,o.prototype.delimiter=".",o.prototype.setMaxListeners=function(e){this._events||i.call(this),this._events.maxListeners=e,this._conf||(this._conf={}),this._conf.maxListeners=e},o.prototype.event="",o.prototype.once=function(e,t){return this.many(e,1,t),this},o.prototype.many=function(e,t,n){function r(){0===--t&&i.off(e,r),n.apply(this,arguments)}var i=this;if("function"!=typeof n)throw new Error("many only accepts instances of Function");return r._origin=n,this.on(e,r),i},o.prototype.emit=function(){this._events||i.call(this);var e=arguments[0];if("newListener"===e&&!this.newListener&&!this._events.newListener)return!1;if(this._all){for(var t=arguments.length,n=new Array(t-1),r=1;t>r;r++)n[r-1]=arguments[r];for(r=0,t=this._all.length;t>r;r++)this.event=e,this._all[r].apply(this,[e].concat(n))}if("error"===e&&!(this._all||this._events.error||this.wildcard&&this.listenerTree.error))throw arguments[1]instanceof Error?arguments[1]:new Error("Uncaught, unspecified 'error' event.");var s;if(this.wildcard){s=[];var o="string"==typeof e?e.split(this.delimiter):e.slice();l.call(this,s,o,this.listenerTree,0)}else s=this._events[e];if("function"==typeof s){if(this.event=e,1===arguments.length)s.call(this);else if(arguments.length>1)switch(arguments.length){case 2:s.call(this,arguments[1]);break;case 3:s.call(this,arguments[1],arguments[2]);break;default:for(var t=arguments.length,n=new Array(t-1),r=1;t>r;r++)n[r-1]=arguments[r];s.apply(this,n)}return!0}if(s){for(var t=arguments.length,n=new Array(t-1),r=1;t>r;r++)n[r-1]=arguments[r];for(var c=s.slice(),r=0,t=c.length;t>r;r++)this.event=e,c[r].apply(this,n);return c.length>0||!!this._all}return!!this._all},o.prototype.emitAsync=function(){this._events||i.call(this);var e=arguments[0];if("newListener"===e&&!this.newListener&&!this._events.newListener)return Promise.resolve([!1]);var t=[];if(this._all){for(var n=arguments.length,r=new Array(n-1),s=1;n>s;s++)r[s-1]=arguments[s];for(s=0,n=this._all.length;n>s;s++)this.event=e,t.push(this._all[s].apply(this,r))}if("error"===e&&!(this._all||this._events.error||this.wildcard&&this.listenerTree.error))return arguments[1]instanceof Error?Promise.reject(arguments[1]):Promise.reject("Uncaught, unspecified 'error' event.");var o;if(this.wildcard){o=[];var c="string"==typeof e?e.split(this.delimiter):e.slice();l.call(this,o,c,this.listenerTree,0)}else o=this._events[e];if("function"==typeof o){if(this.event=e,1===arguments.length)t.push(o.call(this));else if(arguments.length>1)switch(arguments.length){case 2:t.push(o.call(this,arguments[1]));break;case 3:t.push(o.call(this,arguments[1],arguments[2]));break;default:for(var n=arguments.length,r=new Array(n-1),s=1;n>s;s++)r[s-1]=arguments[s];t.push(o.apply(this,r))}}else if(o){for(var n=arguments.length,r=new Array(n-1),s=1;n>s;s++)r[s-1]=arguments[s];for(var a=o.slice(),s=0,n=a.length;n>s;s++)this.event=e,t.push(a[s].apply(this,r))}return Promise.all(t)},o.prototype.on=function(e,t){if("function"==typeof e)return this.onAny(e),this;if("function"!=typeof t)throw new Error("on only accepts instances of Function");if(this._events||i.call(this),this.emit("newListener",e,t),this.wildcard)return c.call(this,e,t),this;if(this._events[e]){if("function"==typeof this._events[e])this._events[e]=[this._events[e],t];else if(a(this._events[e])&&(this._events[e].push(t),!this._events[e].warned)){var n=f;"undefined"!=typeof this._events.maxListeners&&(n=this._events.maxListeners),n>0&&this._events[e].length>n&&(this._events[e].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[e].length),console.trace&&console.trace())}}else this._events[e]=t;return this},o.prototype.onAny=function(e){if("function"!=typeof e)throw new Error("onAny only accepts instances of Function");return this._all||(this._all=[]),this._all.push(e),this},o.prototype.addListener=o.prototype.on,o.prototype.off=function(e,n){function r(e){if(e!==t){var n=Object.keys(e);for(var i in n){var s=n[i],o=e[s];o instanceof Function||"object"!=typeof o||(Object.keys(o).length>0&&r(e[s]),0===Object.keys(o).length&&delete e[s])}}}if("function"!=typeof n)throw new Error("removeListener only takes instances of Function");var i,s=[];if(this.wildcard){var o="string"==typeof e?e.split(this.delimiter):e.slice();s=l.call(this,null,o,this.listenerTree,0)}else{if(!this._events[e])return this;i=this._events[e],s.push({_listeners:i})}for(var c=0;c<s.length;c++){var f=s[c];if(i=f._listeners,a(i)){for(var u=-1,h=0,p=i.length;p>h;h++)if(i[h]===n||i[h].listener&&i[h].listener===n||i[h]._origin&&i[h]._origin===n){u=h;break}if(0>u)continue;return this.wildcard?f._listeners.splice(u,1):this._events[e].splice(u,1),0===i.length&&(this.wildcard?delete f._listeners:delete this._events[e]),this.emit("removeListener",e,n),this}(i===n||i.listener&&i.listener===n||i._origin&&i._origin===n)&&(this.wildcard?delete f._listeners:delete this._events[e],this.emit("removeListener",e,n))}return r(this.listenerTree),this},o.prototype.offAny=function(e){var t,n=0,r=0;if(e&&this._all&&this._all.length>0){for(t=this._all,n=0,r=t.length;r>n;n++)if(e===t[n])return t.splice(n,1),this.emit("removeListenerAny",e),this}else{for(t=this._all,n=0,r=t.length;r>n;n++)this.emit("removeListenerAny",t[n]);this._all=[]}return this},o.prototype.removeListener=o.prototype.off,o.prototype.removeAllListeners=function(e){if(0===arguments.length)return!this._events||i.call(this),this;if(this.wildcard)for(var t="string"==typeof e?e.split(this.delimiter):e.slice(),n=l.call(this,null,t,this.listenerTree,0),r=0;r<n.length;r++){var s=n[r];s._listeners=null}else{if(!this._events||!this._events[e])return this;this._events[e]=null}return this},o.prototype.listeners=function(e){if(this.wildcard){var t=[],n="string"==typeof e?e.split(this.delimiter):e.slice();return l.call(this,t,n,this.listenerTree,0),t}return this._events||i.call(this),this._events[e]||(this._events[e]=[]),a(this._events[e])||(this._events[e]=[this._events[e]]),this._events[e]},o.prototype.listenersAny=function(){return this._all?this._all:[]},"function"==typeof e&&e.amd?e(function(){return o}):"object"==typeof r?n.exports=o:window.EventEmitter2=o}()},{}],3:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function s(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(n,"__esModule",{value:!0});var l=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),c=e("eventemitter2"),a=e("../services/connect"),f=r(a),u="connected-client",h="disconnected-client",p=function(e){function t(e){i(this,t);var n=s(this,Object.getPrototypeOf(t).call(this));return n.connect=new f["default"](e),n.connect.send("server",{type:u,client:e}),n.connect.on("message",function(){for(var e=arguments.length,t=Array(e),r=0;e>r;r++)t[r]=arguments[r];n.emit.apply(n,["message"].concat(t))}),window.addEventListener("unload",function(){n.connect.send("server",{type:h,client:e})}),n}return o(t,e),l(t,[{key:"send",value:function(e,t){this.connect.send(e,t)}}]),t}(c.EventEmitter2);n["default"]=p},{"../services/connect":5,eventemitter2:2}],4:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function s(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(n,"__esModule",{value:!0});var l=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),c=e("eventemitter2"),a=e("../services/connect"),f=r(a),u="connected-client",h="disconnected-client",p=function(e){function t(){i(this,t);var e=s(this,Object.getPrototypeOf(t).call(this));return e.handlerMessage=function(t,n,r){var i=t.type,s=t.client;switch(i){case u:e.clients.push(s),e.emit("connected-client",s),r();break;case h:e.clients=e.clients.filter(function(e){return e!==s}),e.emit("disconnected-client",s),r();break;default:e.emit("message",t,n,r)}},e.clients=[],e.connect=new f["default"]("server"),e.connect.on("message",e.handlerMessage),e}return o(t,e),l(t,[{key:"getConnectedClients",value:function(){return this.clients}},{key:"send",value:function(e,t){return this.connect.send(e,t)}}]),t}(c.EventEmitter2);n["default"]=p},{"../services/connect":5,eventemitter2:2}],5:[function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function s(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(n,"__esModule",{value:!0});var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),l=e("eventemitter2"),c=chrome.runtime,a=function(e){function t(e){r(this,t);var n=i(this,Object.getPrototypeOf(t).call(this));return n.handlerMessage=function(e,t,r){return n.sender===e.receiver?(n.emit("message",e.data,e.sender,r),!0):void 0},n.sender=e||null,null!=c.onMessage?c.onMessage.addListener(n.handlerMessage):console.warn("Messageing-system: not define onMessage of runtime"),n}return s(t,e),o(t,[{key:"getSender",value:function(){return this.sender}},{key:"send",value:function(e,t){var n={sender:this.sender,receiver:e,data:t};return new Promise(function(e,t){return c.sendMessage(n,e),!0})}}]),t}(l.EventEmitter2);n["default"]=a},{eventemitter2:2}]},{},[1])(1)});